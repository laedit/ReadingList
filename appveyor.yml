version: 1.0.{build}

environment:
  ftp_password:
    secure: eK/zCvZEGU6BcRfo1CoYnlrLD7SoyaUyOb3aIq8CkmQ=
  access_token:
    secure: CF5fbrJvzIdoFSlDdW4c5NQUzca/B75Bxqp9kwCvp5yksTLiUxaDzhh0WsmLXp4P
  publisher_id:
    secure: cGDidYlVbJZkd9Fy7m1nRw==
  publisher_password:
    secure: bh3TjAp9X66mDDJ46/g8wghjC5nce34YA3Y9EGXz+qY=
  git_mail:
    secure: bVPyDjOtyByKm9rSo/rjN79B6Z6/pI1hhbhYZHiAJ/E=

install:
  - choco install pretzel -y

cache:
  - C:\tools\Pretzel -> appveyor.yml

build_script:
- git checkout master
- "\"C:\\Program Files (x86)\\Microsoft SDKs\\F#\\4.0\\Framework\\v4.0\\fsi\" GetBooksInfo.fsx"
- git config --global user.name "Jérémie Bertrand"
- git config --global user.email "%git_mail%"
- git config --global credential.helper store
- ps: Add-Content "$env:USERPROFILE\.git-credentials" "https://$($env:access_token):x-oauth-basic@github.com`n"
- git add .
- git commit -m "Add new posts [skip ci]"
- git push origin master
- ps: Set-Culture fr-FR
- C:\tools\Pretzel\Pretzel bake site

test: off

artifacts:
- path: site/_site
  name: compiled_site

before_deploy:
- ps: .\Clear-FtpDirectory.ps1

deploy:
- provider: FTP
  host: laedit.net
  protocol: ftp
  username: zlaeditn12713ne
  password:
    secure: eK/zCvZEGU6BcRfo1CoYnlrLD7SoyaUyOb3aIq8CkmQ=
  folder: /httpdocs/readinglist
  application: site\compiled_site.zip